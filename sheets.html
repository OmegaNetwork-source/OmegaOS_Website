<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omega Sheets</title>
    <link rel="stylesheet" href="sheets.css">
</head>
<body>
    <!-- Window Title Bar -->
    <div class="window-titlebar">
        <div class="window-titlebar-left">
            <div class="file-menu-container">
                <button class="file-menu-btn" id="fileMenuBtn">File</button>
                <div class="file-menu-dropdown" id="fileMenuDropdown">
                    <div class="file-menu-item" id="fileMenuNew">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <line x1="12" y1="8" x2="12" y2="16"/>
                            <line x1="8" y1="12" x2="16" y2="12"/>
                        </svg>
                        <span>New</span>
                        <span class="file-menu-shortcut">Ctrl+N</span>
                    </div>
                    <div class="file-menu-item" id="fileMenuOpen">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        <span>Open</span>
                        <span class="file-menu-shortcut">Ctrl+O</span>
                    </div>
                    <div class="file-menu-divider"></div>
                    <div class="file-menu-item" id="fileMenuSave">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        <span>Save</span>
                        <span class="file-menu-shortcut">Ctrl+S</span>
                    </div>
                    <div class="file-menu-item" id="fileMenuSaveAs">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        <span>Save As...</span>
                    </div>
                </div>
            </div>
            <div class="window-title">Omega Sheets</div>
        </div>
        <div class="window-controls">
            <button class="window-control minimize" id="minimizeBtn">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="0" y1="6" x2="12" y2="6"/>
                </svg>
            </button>
            <button class="window-control maximize" id="maximizeBtn">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="2" y="2" width="8" height="8"/>
                </svg>
            </button>
            <button class="window-control close" id="closeBtn">
                <svg viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="2" y1="2" x2="10" y2="10"/>
                    <line x1="10" y1="2" x2="2" y2="10"/>
                </svg>
            </button>
        </div>
    </div>

    <!-- Toolbar -->
    <div class="toolbar">
        <div class="toolbar-group">
            <button class="toolbar-btn" id="newBtn" title="New">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <line x1="12" y1="8" x2="12" y2="16"/>
                    <line x1="8" y1="12" x2="16" y2="12"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="openBtn" title="Open">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="saveBtn" title="Save">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="boldBtn" title="Bold">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                    <path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="italicBtn" title="Italic">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="19" y1="4" x2="10" y2="4"/>
                    <line x1="14" y1="20" x2="5" y2="20"/>
                    <line x1="15" y1="4" x2="9" y2="20"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="underlineBtn" title="Underline">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 3v7a6 6 0 0 0 6 6 6 6 0 0 0 6-6V3"/>
                    <line x1="4" y1="21" x2="20" y2="21"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="copyBtn" title="Copy (Ctrl+C)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="pasteBtn" title="Paste (Ctrl+V)">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/>
                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="sumBtn" title="Auto Sum">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 16V8M12 2v20M6 8v8"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="aiBtn" title="AI Assistant">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2 L2 7 L12 12 L22 7 Z"/>
                    <path d="M2 17 L12 22 L22 17"/>
                    <path d="M2 12 L12 17 L22 12"/>
                </svg>
                <span style="font-size: 11px; margin-left: 4px;">AI</span>
            </button>
            <button class="toolbar-btn" id="averageBtn" title="Average">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <line x1="12" y1="8" x2="12" y2="16"/>
                    <line x1="8" y1="12" x2="16" y2="12"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="createTableBtn" title="Create Table">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <line x1="3" y1="9" x2="21" y2="9"/>
                    <line x1="9" y1="21" x2="9" y2="9"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="sortBtn" title="Sort">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18M7 12h10M11 18h2"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="filterBtn" title="Filter">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="insertRowBtn" title="Insert Row">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="insertColBtn" title="Insert Column">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="deleteRowBtn" title="Delete Row">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="5" y1="12" x2="19" y2="12"/>
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                </svg>
            </button>
            <button class="toolbar-btn" id="deleteColBtn" title="Delete Column">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="formatNumberBtn" title="Number Format">
                <span style="font-weight: bold;">123</span>
            </button>
            <button class="toolbar-btn" id="formatCurrencyBtn" title="Currency Format">
                <span style="font-weight: bold;">$</span>
            </button>
            <button class="toolbar-btn" id="formatPercentBtn" title="Percentage Format">
                <span style="font-weight: bold;">%</span>
            </button>
        </div>
        <div class="toolbar-divider"></div>
        <div class="toolbar-group">
            <button class="toolbar-btn" id="addSheetBtn" title="Add Sheet">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <line x1="12" y1="8" x2="12" y2="16"/>
                    <line x1="8" y1="12" x2="16" y2="12"/>
                </svg>
            </button>
        </div>
        <div class="toolbar-group">
            <input type="text" class="formula-bar" id="formulaBar" placeholder="Formula">
        </div>
    </div>

    <!-- Debug Panel - Hidden by default -->
    <div id="debugPanel" style="display: none; position: fixed; top: 50px; left: 10px; background: rgba(0,0,0,0.9); color: #0f0; padding: 15px; border-radius: 8px; z-index: 99999; max-width: 500px; max-height: 400px; overflow-y: auto; font-family: monospace; font-size: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.5);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <strong style="color: #0ff;">DEBUG PANEL</strong>
            <button id="closeDebugBtn" style="background: #333; color: white; border: 1px solid #555; padding: 4px 8px; border-radius: 4px; cursor: pointer;">Close</button>
        </div>
        <div id="debugContent" style="line-height: 1.6;">
            <div style="color: #ff0;">Initializing...</div>
        </div>
    </div>

    <!-- Spreadsheet -->
    <div class="spreadsheet-container">
        <div class="spreadsheet-header">
            <div class="row-header"></div>
            <div class="column-headers" id="columnHeaders"></div>
        </div>
        <div class="spreadsheet-body">
            <div class="row-numbers" id="rowNumbers"></div>
            <div class="cells-container" id="cellsContainer"></div>
        </div>
    </div>

    <!-- Sheet Tabs -->
    <div class="sheet-tabs-container">
        <div class="sheet-tabs" id="sheetTabs">
            <!-- Sheets will be added dynamically -->
        </div>
        <button class="sheet-tab-add" id="addSheetTabBtn" title="Add Sheet">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        </button>
    </div>

    <script>
        // Immediate debug setup - runs before anything else
        (function() {
            function initDebug() {
                const debugContent = document.getElementById('debugContent');
                if (debugContent) {
                    debugContent.innerHTML = '<div style="color: #0ff;">âœ… Debug system ready</div>';
                    window.debugLog = function(message, type = 'info') {
                        const content = document.getElementById('debugContent');
                        if (!content) {
                            console.log(`[SHEETS DEBUG] ${message}`);
                            return;
                        }
                        
                        const timestamp = new Date().toLocaleTimeString();
                        const colors = {
                            info: '#0f0',
                            error: '#f00',
                            warn: '#ff0',
                            success: '#0ff'
                        };
                        const color = colors[type] || colors.info;
                        
                        const div = document.createElement('div');
                        div.style.color = color;
                        div.textContent = `[${timestamp}] ${message}`;
                        content.appendChild(div);
                        content.scrollTop = content.scrollHeight;
                        
                        console.log(`[SHEETS DEBUG] ${message}`);
                    };
                    console.log('Debug system initialized');
                    window.debugLog('Debug system initialized in HTML', 'success');
                } else {
                    console.error('Debug content element not found!');
                }
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initDebug);
            } else {
                initDebug();
            }
        })();
    </script>
    <script>
        // Check if sheets.js loads
        window.debugLog('Attempting to load sheets.js...', 'info');
        window.addEventListener('error', function(e) {
            if (window.debugLog) {
                window.debugLog('JavaScript Error: ' + e.message, 'error');
                window.debugLog('File: ' + (e.filename || 'unknown'), 'error');
                window.debugLog('Line: ' + (e.lineno || 'unknown'), 'error');
            }
        });
    </script>
    <script src="sheets-simple.js" onerror="if(window.debugLog) window.debugLog('ERROR: sheets-simple.js failed to load!', 'error');" onload="if(window.debugLog) window.debugLog('sheets-simple.js loaded successfully', 'success');"></script>
    <!-- Fallback: try original sheets.js if simple version doesn't work -->
    <!-- <script src="sheets.js"></script> -->
    <script>
        // Load formula engine after main script, with error handling
        if (typeof window.calculateFormula !== 'function') {
            const script = document.createElement('script');
            script.src = 'sheets-formula-engine.js';
            script.onerror = () => {
                if (window.debugLog) window.debugLog('Formula engine failed to load, using fallback', 'warn');
                console.warn('[SHEETS] Formula engine failed to load, using fallback');
            };
            document.head.appendChild(script);
        }
    </script>
</body>
</html>
